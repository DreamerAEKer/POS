<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Anti-Cache Meta Tags -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>ร้านชำ POS (Grocery POS)</title>

    <!-- Google Fonts: Sarabun (Modern Thai font, readable) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons: Material Symbols Rounded -->
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />

    <link rel="stylesheet" href="css/variables.css?v=0.89.29">
    <link rel="stylesheet" href="css/styles.css?v=0.89.29">
    <link rel="stylesheet" href="css/print.css?v=0.89.29">
</head>

<body>
    <div id="app">
        <!-- Sidebar Navigation -->
        <nav id="sidebar">
            <div class="brand">
                <span class="material-symbols-rounded logo-icon">storefront</span>
                <h1>ร้านชำ</h1>
            </div>

            <ul class="nav-menu">
                <li class="nav-item active" data-view="pos">
                    <span class="material-symbols-rounded">point_of_sale</span>
                    <span>ขายสินค้า</span>
                </li>
                <li class="nav-item" data-view="sales">
                    <span class="material-symbols-rounded">payments</span>
                    <span>ยอดขาย</span>
                </li>
                <li class="nav-item" data-view="stock">
                    <span class="material-symbols-rounded">inventory_2</span>
                    <span>สต็อก</span>
                </li>
                <li class="nav-item" data-view="suppliers">
                    <span class="material-symbols-rounded">local_shipping</span>
                    <span>ร้านส่ง</span>
                </li>
                <li class="nav-item" data-view="tables">
                    <span class="material-symbols-rounded">table_restaurant</span>
                    <span>โต๊ะ</span>
                </li>
                <li class="nav-item" id="btn-check-price">
                    <span class="material-symbols-rounded">price_check</span>
                    <span>เช็คราคา</span>
                </li>

                <li class="nav-item" data-view="settings" style="margin-top: auto;">
                    <span class="material-symbols-rounded">settings</span>
                    <span>ตั้งค่า</span>
                </li>
            </ul>

            <div class="nav-footer">
                <button id="btn-parked-carts" class="secondary-btn">
                    <span class="material-symbols-rounded">shopping_basket</span>
                    พักบิล <span id="parked-count" class="badge">0</span>
                </button>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main id="main-content">
            <!-- Top Bar -->
            <header class="top-bar">
                <div class="search-container">
                    <span class="material-symbols-rounded">search</span>
                    <input type="text" id="global-search" placeholder="ค้นหา / สแกนบาร์โค้ด..." inputmode="text"
                        autofocus>
                    <button id="btn-scan-trigger" class="icon-btn">
                        <span class="material-symbols-rounded">qr_code_scanner</span>
                    </button>
                </div>
                <div class="status-indicators">
                    <div class="date-time" id="clock">12:00</div>
                </div>
            </header>

            <!-- Dynamic View Container -->
            <div id="view-container">
                <!-- Views will be injected here by JS -->
            </div>
        </main>

        <!-- Right Panel (Cart / Details) -->
        <aside id="right-panel">
            <!-- Cart View -->
            <div id="cart-panel">
                <div class="cart-header">
                    <h2 id="cart-header-title">ตะกร้าสินค้า</h2>
                    <button class="icon-btn dangerous" id="btn-clear-cart">
                        <span class="material-symbols-rounded">delete</span>
                    </button>
                </div>

                <div class="cart-items" id="cart-items-container">
                    <!-- Cart Items go here -->
                    <div class="empty-state">
                        <span class="material-symbols-rounded">shopping_cart_off</span>
                        <p>ยังไม่มีสินค้า</p>
                    </div>
                </div>

                <div class="cart-footer">
                    <div class="summary-row">
                        <span>รวมเงิน</span>
                        <span class="total-price" id="cart-total">0.00</span>
                    </div>
                    <div class="action-buttons" style="display: flex; gap: 5px;">
                        <button id="btn-park-cart" class="secondary-btn" style="flex:1;">พักบิล</button>
                        <button id="btn-quick-print" class="secondary-btn" title="รับเงินพอดี & พิมพ์ใบเสร็จ"
                            style="padding: 10px; border-color: #ccc; color: #555; display: flex; align-items: center; justify-content: center;">
                            <span class="material-symbols-rounded">print</span>
                        </button>
                        <button id="btn-checkout" class="primary-btn" style="flex:2;">รับเงิน</button>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Mobile Cart Toggle Button (FAB) -->
    <div id="btn-mobile-cart" class="mobile-cart-btn">
        <span class="material-symbols-rounded">shopping_cart</span>
        <span id="mobile-cart-count" class="mobile-cart-count">0</span>
    </div>



    <!-- Mobile Cart Overlay (for closing side panel) -->
    <div id="mobile-cart-overlay"
        style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:15;display:none;"></div>

    <!-- Modals -->
    <div id="modal-overlay" class="hidden">
        <div id="price-check-modal" class="modal hidden">
            <!-- Price Check Content -->
        </div>
        <div id="payment-modal" class="modal hidden">
            <!-- Payment Content -->
        </div>
        <div id="product-modal" class="modal hidden">
            <!-- Add/Edit Product Content -->
        </div>
        <div id="security-modal" class="modal hidden" style="max-width:300px; text-align:center;">
            <span class="material-symbols-rounded" style="font-size:48px; color:var(--neutral-800);">lock</span>
            <h3>กรุณาใส่รหัสผ่าน</h3>
            <input type="password" id="security-pin-input" maxlength="4"
                style="width:100%; padding:10px; font-size:24px; text-align:center; margin:15px 0; letter-spacing:8px;"
                inputmode="numeric">
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <button class="secondary-btn" onclick="App.closeModals()">ยกเลิก</button>
                <button class="primary-btn" id="btn-security-confirm">ยืนยัน</button>
            </div>
        </div>


        <div id="confirmation-modal" class="modal hidden" style="max-width:320px; text-align:center; padding: 20px;">
            <div style="font-size: 48px; margin-bottom: 10px;" id="confirm-icon">❓</div>
            <h3 id="confirm-title" style="margin-bottom:10px; font-size: 18px;">ยืนยัน</h3>
            <p id="confirm-message" style="margin-bottom:20px; color:#555; font-size: 16px;">ข้อความ</p>
            <input type="text" id="confirm-input" class="hidden"
                style="width:100%; padding:10px; margin-bottom:20px; border:1px solid #ddd; border-radius:4px; font-size:16px;">
            <div style="display:flex; gap:10px; justify-content:center;">
                <button id="btn-confirm-cancel" class="secondary-btn" style="flex:1;">ยกเลิก</button>
                <button id="btn-confirm-ok" class="primary-btn" style="flex:1;">ตกลง</button>
            </div>
        </div>
    </div>

    <!-- Hidden Receipt for Printing -->
    <div id="receipt-print-area"></div>



    <!-- Mobile Bottom Navigation (Dedicated Structure) -->
    <nav id="mobile-bottom-nav">
        <div class="nav-item active" data-view="pos">
            <span class="material-symbols-rounded">point_of_sale</span>
            <span>ขาย</span>
        </div>
        <div class="nav-item" data-view="sales">
            <span class="material-symbols-rounded">payments</span>
            <span>ยอดขาย</span>
        </div>
        <div class="nav-item" data-view="stock">
            <span class="material-symbols-rounded">inventory_2</span>
            <span>สต็อก</span>
        </div>
        <div class="nav-item" data-view="suppliers">
            <span class="material-symbols-rounded">local_shipping</span>
            <span>ร้านส่ง</span>
        </div>
        <div class="nav-item" data-view="tables">
            <span class="material-symbols-rounded">table_restaurant</span>
            <span>โต๊ะ</span>
        </div>
        <button type="button" class="nav-action-item" id="btn-parked-mobile-final"
            ontouchstart="window.handleParkInteraction(event)" onclick="window.handleParkInteraction(event)"
            style="z-index: 2147483647 !important; position: relative; pointer-events: auto !important;">
            <!-- Converted to button for native touch handling -->
            <span class="material-symbols-rounded">shopping_basket</span>
            <span>พักบิล</span>
        </button>
        <div class="nav-item" data-view="settings">
            <span class="material-symbols-rounded">settings</span>
            <span>ตั้งค่า</span>
        </div>
    </nav>

    <!-- Global Version Display -->
    <div id="app-version-display"
        style="position: fixed; bottom: 5px; right: 10px; font-size: 11px; color: rgba(0,0,0,0.3); z-index: 10000; pointer-events: none; font-weight: bold;">
    </div>

    <!-- Scripts (Order matters for file:// compatibility without modules) -->
    <script src="js/utils.js?v=0.89.29"></script>
    <script src="js/db.js?v=0.89.29"></script>
    <script src="js/app.js?v=0.89.29"></script>
    <link rel="stylesheet" href="css/styles.css?v=0.89.29">
</body>

</html>